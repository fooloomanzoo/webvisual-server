<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-ripple/paper-ripple.html">

<link rel="import" href="behaviors/localize-behavior.html">

<link rel="import" href="components/webvisual-icon-button.html">

<link rel="import" href="style/shared-styles.html">
<link rel="import" href="style/webvisual-button.html">

<dom-module id="webvisual-home">

  <template strip-whitespace>
    <style include="shared-styles webvisual-button">
      :host {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        min-height: 100vh;
        box-sizing: border-box;
        color: var(--bright-text-color);
        outline: none;
        overflow-y: auto;
        overflow-x: hidden;
      }
      .box {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        box-sizing: border-box;
        font-size: 1em;
        line-height: 1.4;
        margin: 2em;
      }
      .box > * {
        flex: 1 0 auto;
        width: 100%;
      }
      .item {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        color: var(--hightlight-color);
        font-size: 1em;
        white-space: pre-line;
        text-decoration: none;
        text-align: center;
      }
      h1 {
        font-weight: normal;
        font-size: 2em;
        margin: 0;
        padding: 0 1.5em 0.5em 1.5em;
        text-align: center;
        white-space: normal;
      }
      a {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        text-decoration: none;
      }
      .item.facility {
        margin: 24px;
        border-radius: 16px;
        border: thin solid var(--highlight-color);
      }
      .item.facility.iron-selected,
      .item.facility.iron-selected:hover {
        font-size: 1.25em;
        background-color: rgba(255, 255, 255, 0.25);
        border-width: medium;
      }
      .item.system {
        box-sizing: border-box;
        margin-bottom: 0.75em;
        border-radius: 8px;
        border: thin solid var(--highlight-color);
      }
      .item.system:hover {
        color: var(--bright-text-color);
      }
      iron-collapse {
        margin-bottom: 1.5em;
      }
      .collapse-content {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-align: stretch;
        -webkit-align-items: stretch;
        align-items: stretch;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
        margin: 0 60px;
      }
      a:link,
      a:visited {
        color: var(--bright-text-color);
      }
      a:active {
        color: var(--active-link-color);
      }
      .login {
        position: absolute;
        color: var(--notification-color);
        top: 1em;
        opacity: 0.5;
        width: auto;
        font-size: 1.25em;
        background-color: #252525;
        border-radius: 12px;
        border: thin solid currentColor;
        transition: opacity 300ms cubic-bezier(0.6,0,0.3,1);
        padding: 0 16px;
        display: inline-flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        word-wrap: break-word;
      }
      .login:focus,
      .login:hover {
        opacity: 1;
      }
      @media (min-width: 768px) {
        .box {
          max-width: 68vw;
        }
      }

    </style>

    <template is="dom-if" if="[[!loggedIn]]">
      <a href="/login" class="login">
        <webvisual-icon-button icon="assignment-ind"></webvisual-icon-button>
        <span>{{localize('login', 'title')}}</span>
      </a>
    </template>

    <div class="box">
      <template is="dom-if" if="[[_shouldRenderHeader]]">
        <header>
          <h1>{{localize('home', 'title')}}</h1>
        </header>
      </template>
      <iron-selector id="selector" selected="{{currentFacility}}" attr-for-selected="item-name" selectable=".facility">
        <template is="dom-repeat" items="[[facilities]]">
          <div raised class="webvisual-button item facility" item-name="[[item.name]]" title$="[[item.title]]" tabindex="1">
            <paper-ripple id="ripple" recenters></paper-ripple>
            <div>[[item.title]]</div>
          </div>

          <iron-collapse opened="{{_computeOpened(item.name, currentFacility)}}">
            <div class="collapse-content">
              <template is="dom-repeat" items="[[item.systems]]" as="system">
                <a href$="[[_computeHref(system.view, item.name, system.name)]]" tabindex="-1">
                  <div raised class="webvisual-button item system" title$="[[system.title]]" tabindex="1">
                    <paper-ripple id="ripple" recenters></paper-ripple>
                    <div>[[system.title]]</div>
                  </div>
                </a>
              </template>
            </div>
          </iron-collapse>
        </template>
      </iron-selector>
    </div>

  </template>

  <script>

    Polymer({

      is: 'webvisual-home',

      behaviors: [
        WebvisualBehaviors.LocalizeBehavior
      ],

      properties: {

        facilities: {
          type: Array
        },

        currentFacility: {
          type: String,
          notify: true
        },

        visible: {
          type: Boolean,
          observer: '_visibleChanged'
        },

        loggedIn: {
          type: Boolean
        },

        _shouldRenderHeader: {
          type: Boolean,
          computed: '_computeShouldRenderBox(facilities)'
        }
      },

      _visibleChanged: function(visible) {
        if (visible) {
          this.fire('change-page', { title: 'Home' });
        }
      },

      _computeHref: function(view, facility, system) {
        return '/' + (view || 'list') + '/' + facility + '/' + system;
      },

      _computeOpened: function(name, selected) {
        return (name === selected);
      },

      _computeShouldRenderBox: function(facilities) {
        this.loggedIn = (facilities && facilities.length > 0) ? this.loggedIn : false;
        return facilities && facilities.length > 0;
      }
    });

  </script>

</dom-module>
