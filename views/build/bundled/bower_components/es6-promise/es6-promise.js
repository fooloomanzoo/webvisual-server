(function(a,b){'object'===typeof exports&&'undefined'!==typeof module?module.exports=b():'function'===typeof define&&define.amd?define(b):a.ES6Promise=b()})(this,function(){'use strict';function a(a){var b=typeof a;return null!==a&&('object'===b||'function'===b)}function b(a){return'function'===typeof a}function c(){return'undefined'===typeof H?d():function(){H(e)}}function d(){var a=setTimeout;return function(){return a(e,1)}}function e(){for(var a=0;a<L;a+=2){var b=S[a],c=S[a+1];b(c),S[a]=void 0,S[a+1]=void 0}L=0}function f(a,b){var c=arguments,d=this,e=new this.constructor(h);void 0===e[U]&&A(e);var f=d._state;return f?function(){var a=c[f-1];M(function(){return x(f,e,a,d._result)})}():t(d,e,a,b),e}function g(a){var b=this;if(a&&'object'===typeof a&&a.constructor===b)return a;var c=new b(h);return p(c,a),c}function h(){}function i(){return new TypeError('You cannot resolve a promise with itself')}function j(){return new TypeError('A promises callback cannot return that same promise.')}function k(a){try{return a.then}catch(a){return X.error=a,X}}function l(a,b,c,d){try{a.call(b,c,d)}catch(a){return a}}function m(a,b,c){M(function(a){var d=!1,e=l(c,b,function(c){d||(d=!0,b===c?r(a,c):p(a,c))},function(b){d||(d=!0,s(a,b))},'Settle: '+(a._label||' unknown promise'));!d&&e&&(d=!0,s(a,e))},a)}function n(a,b){b._state===V?r(a,b._result):b._state===W?s(a,b._result):t(b,void 0,function(b){return p(a,b)},function(b){return s(a,b)})}function o(a,c,d){c.constructor===a.constructor&&d===f&&c.constructor.resolve===g?n(a,c):d===X?(s(a,X.error),X.error=null):void 0===d?r(a,c):b(d)?m(a,c,d):r(a,c)}function p(b,c){b===c?s(b,i()):a(c)?o(b,c,k(c)):r(b,c)}function q(a){a._onerror&&a._onerror(a._result),u(a)}function r(a,b){a._state!==T||(a._result=b,a._state=V,0!==a._subscribers.length&&M(u,a))}function s(a,b){a._state!==T||(a._state=W,a._result=b,M(q,a))}function t(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+V]=c,e[f+W]=d,0===f&&a._state&&M(u,a)}function u(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?x(c,d,e,f):e(f);a._subscribers.length=0}}function v(){this.error=null}function w(a,b){try{return a(b)}catch(a){return Y.error=a,Y}}function x(a,c,d,e){var f,g,h,i,k=b(d);if(!k)f=e,h=!0;else if(f=w(d,e),f===Y?(i=!0,g=f.error,f.error=null):h=!0,c===f)return void s(c,j());c._state!==T||(k&&h?p(c,f):i?s(c,g):a===V?r(c,f):a===W&&s(c,f))}function y(a,b){try{b(function(b){p(a,b)},function(b){s(a,b)})}catch(b){s(a,b)}}function z(){return Z++}function A(a){a[U]=Z++,a._state=void 0,a._result=void 0,a._subscribers=[]}function B(a,b){this._instanceConstructor=a,this.promise=new a(h),this.promise[U]||A(this.promise),K(b)?(this.length=b.length,this._remaining=b.length,this._result=Array(this.length),0===this.length?r(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&r(this.promise,this._result))):s(this.promise,C())}function C(){return new Error('Array Methods must be provided an Array')}function D(){throw new TypeError('You must pass a resolver function as the first argument to the promise constructor')}function E(){throw new TypeError('Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.')}function F(a){this[U]=z(),this._result=this._state=void 0,this._subscribers=[],h!==a&&('function'!==typeof a&&D(),this instanceof F?y(this,a):E())}var G=Array.isArray?Array.isArray:function(a){return'[object Array]'===Object.prototype.toString.call(a)};var H,I,J,K=G,L=0,M=function(a,b){S[L]=a,S[L+1]=b,L+=2,2===L&&(I?I(e):J())},N='undefined'===typeof window?void 0:window,O=N||{},P=O.MutationObserver||O.WebKitMutationObserver,Q='undefined'===typeof self&&'undefined'!==typeof process&&'[object process]'==={}.toString.call(process),R='undefined'!==typeof Uint8ClampedArray&&'undefined'!==typeof importScripts&&'undefined'!==typeof MessageChannel,S=Array(1e3);J=Q?function(){return function(){return process.nextTick(e)}}():P?function(){var a=0,b=new P(e),c=document.createTextNode('');return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}():R?function(){var a=new MessageChannel;return a.port1.onmessage=e,function(){return a.port2.postMessage(0)}}():void 0===N&&'function'===typeof require?function(){try{var a=require,b=a('vertx');return H=b.runOnLoop||b.runOnContext,c()}catch(a){return d()}}():d();var T,U=Math.random().toString(36).substring(16),V=1,W=2,X=new v,Y=new v,Z=0;return B.prototype._enumerate=function(a){for(var b=0;this._state===T&&b<a.length;b++)this._eachEntry(a[b],b)},B.prototype._eachEntry=function(a,b){var d=this._instanceConstructor,c=d.resolve;if(c===g){var e=k(a);if(e===f&&a._state!==T)this._settledAt(a._state,b,a._result);else if('function'!==typeof e)this._remaining--,this._result[b]=a;else if(d===F){var i=new d(h);o(i,a,e),this._willSettleAt(i,b)}else this._willSettleAt(new d(function(b){return b(a)}),b)}else this._willSettleAt(c(a),b)},B.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===T&&(this._remaining--,a===W?s(d,c):this._result[b]=c),0===this._remaining&&r(d,this._result)},B.prototype._willSettleAt=function(a,b){var c=this;t(a,void 0,function(a){return c._settledAt(V,b,a)},function(a){return c._settledAt(W,b,a)})},F.all=function(a){return new B(this,a).promise},F.race=function(a){var b=this;return K(a)?new b(function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}):new b(function(a,b){return b(new TypeError('You must pass an array to race.'))})},F.resolve=g,F.reject=function(a){var b=this,c=new b(h);return s(c,a),c},F._setScheduler=function(a){I=a},F._setAsap=function(a){M=a},F._asap=M,F.prototype={constructor:F,then:f,catch:function(a){return this.then(null,a)}},F.polyfill=function(){var a;if('undefined'!==typeof global)a=global;else if('undefined'!==typeof self)a=self;else try{a=Function('return this')()}catch(a){throw new Error('polyfill failed because global object is unavailable in this environment')}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(a){}if('[object Promise]'===c&&!b.cast)return}a.Promise=F},F.Promise=F,F});