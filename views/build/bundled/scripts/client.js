function WebvisualClient(){this.nodes=new Map,this.mobile=this._testMobile(),this.locationHost='',this.nameSpace='',this.socketRoom='',this.messageId=0,this.messageMap={},this.requests=[]}WebvisualClient.prototype={createSocketConnection:function(a,b){a&&(this.locationHost=a,this.nameSpace=b,!this.webworker&&(this.webworker=new Worker('/scripts/worker.js'),this.webworker.onmessage=function(c){if(c.data){if(c.data.messageId){var d=this.messageMap[c.data.messageId];if(d)return d(c.data.response),void delete this.messageMap[c.data.messageId]}switch(c.data.type){case'initial':this.resetNodes(),this.updateNodes(c.data.values,c.data.splices);for(var f=0;f<this.requests.length;f++)this.webworker.postMessage(this.requests[f]);this.requests.length=0;break;case'update':this.updateNodes(c.data.values,c.data.splices);break;case'status':this.updateStatus(c.data.status);break;case'reload':this.reloadJob&&(clearTimeout(this.reloadJob),this.reloadJob=null),this.reloadJob=setTimeout(()=>{window.location.reload()},1500);}}}.bind(this)),this.webworker.postMessage({target:'socket',operation:'connect',args:{locationHost:this.locationHost,nameSpace:this.nameSpace}}))},setupConnection:function(a){if(a){if(this.socketRoom=a,!this.webworker)return;this.webworker.postMessage({target:'socket',operation:'setup',args:{socketRoom:this.socketRoom,mobile:this.mobile}})}},disconnect:function(){this.webworker&&this.webworker.postMessage({target:'socket',operation:'disconnect'})},assignStatusNotifications:function(a){this.statusHandler=a},request:function(a,b){this.messageId++,this.messageMap[this.messageId]=b,a.args=a.args||{},a.args.messageId=this.messageId,this.webworker?this.webworker.postMessage(a):a.forced&&this.requests.push(a)},updateStatus:function(a){this.statusHandler&&'sync-disabled'!==this.statusHandler.socketStatus&&this.statusHandler.set('socketStatus',a)},assignElement:function(a){var b=a.item.mount;b&&(!this.nodes.has(b)&&this.nodes.set(b,new Set),this.nodes.get(b).add(a))},retractElement:function(a,b){if(a&&b&&b.mount){var c=b.mount;this.nodes.has(c)&&this.nodes.get(c).delete(a)}},updateNodes:function(a,b){for(var c in a)this.nodes.has(c)&&this.nodes.get(c).forEach(function(d){d.spliceValues(b[c]),d.insertValues(a[c])}),delete a[c],delete b[c]},resetNodes:function(){},_testMobile:function(){var a=window.navigator.userAgent;return /[mM]obi/i.test(a)||/[tT]abvar/i.test(a)||/[aA]ndroid/i.test(a)}},window.Webvisual=new WebvisualClient;