function WebvisualClient(){this.nodes=new Map,this.mobile=this._testMobile(),this.locationHost='',this.nameSpace='',this.socketRoom='',this.messageId=0,this.messageMap={},this.forcedRequests=[]}WebvisualClient.prototype={createSocketConnection:function(b,c){b&&(this.locationHost!==b||this.nameSpace!==c)&&(this.locationHost=b,this.nameSpace=c,!this.webworker&&(this.webworker=new Worker('/scripts/worker.js'),this.webworker.onmessage=function(d){if(d.data){if(d.data.messageId){var f=this.messageMap[d.data.messageId];if(f)return f(d.data.response),void delete this.messageMap[d.data.messageId]}switch(d.data.type){case'initial':this.resetNodes(),this.updateNodes(d.data.values,d.data.splices);for(var g=0;g<this.forcedRequests.length;g++)this.webworker.postMessage(this.forcedRequests[g]);this.forcedRequests.length=0;break;case'update':this.updateNodes(d.data.values,d.data.splices);break;case'status':this.updateStatus(d.data.status);break;case'reload':this.reloadJob&&(clearTimeout(this.reloadJob),this.reloadJob=null),this.reloadJob=setTimeout(function(){window.location.reload()},1500);}}}.bind(this)),this.webworker.postMessage({target:'socket',operation:'connect',args:{locationHost:this.locationHost,nameSpace:this.nameSpace}}))},setupConnection:function(b){if(b){if(this.socketRoom=b,!this.webworker)return;this.webworker.postMessage({target:'socket',operation:'setup',args:{socketRoom:this.socketRoom,mobile:this.mobile}})}},disconnect:function(){this.webworker&&this.webworker.postMessage({target:'socket',operation:'disconnect'})},assignConnector:function(b){this.connector=b},request:function(b,c){this.messageId++,this.messageMap[this.messageId]=c,b.args=b.args||{},b.args.messageId=this.messageId,this.webworker?this.webworker.postMessage(b):b.forced&&this.forcedRequests.push(b)},updateStatus:function(b){this.connector&&'sync-disabled'!==this.connector.socketStatus&&this.connector.set('socketStatus',b)},assignElement:function(b){var c=b.item.mount;c&&(!this.nodes.has(c)&&this.nodes.set(c,new Set),this.nodes.get(c).add(b))},retractElement:function(b,c){if(b&&c&&c.mount){var d=c.mount;this.nodes.has(d)&&this.nodes.get(d).delete(b)}},updateNodes:function(b,c){var d=this;setTimeout(function(){var f=function(j){d.nodes.has(j)&&d.nodes.get(j).forEach(function(k){k.spliceValues(c[j]),k.insertValues(b[j])}),delete c[j]};for(var g in b)f(g)},0)},resetNodes:function(){},_testMobile:function(){var b=window.navigator.userAgent;return /[mM]obi/i.test(b)||/[tT]abconst/i.test(b)||/[aA]ndroid/i.test(b)}},window.Webvisual=new WebvisualClient;