importScripts('/scripts/idb.js'),self.Promise&&self.Promise.all||importScripts('/bower_components/es6-promise/es6-promise.auto.min.js'),function(){function a(b,c,d){this.mount=b,this.indexKey=c,this.options=d,this.dbPromise=idb.open(b,1,function(e){e.createObjectStore(this.indexKey,this.options)}.bind(this))}a.prototype={get:function(c,d,e,g){return this.dbPromise.then(function(h){var j=h.transaction(this.indexKey),k=[],m=j.objectStore(this.indexKey),n=null;return Number.isFinite(c)&&Number.isFinite(d)&&(n=IDBKeyRange.bound(c,d)),m.iterateCursor.call(m,n,g||'next',function(o){!o||k.length>=e||(k.push(o.value),o.continue())}),j.complete.then(function(){var o={};return o[this.mount]=k,o}.bind(this))}.bind(this)).catch(function(h){console.log(h);var j={};return j[this.mount]=[],j})},set:function(c){return this.dbPromise.then(function(d){for(var e=d.transaction(this.indexKey,'readwrite'),g=c.length-1;0<=g;g--)e.objectStore(this.indexKey).put(c[g],c[g][this.indexKey]);return e.complete}.bind(this)).catch(function(d){return console.log(d,d.name),{}})},last:function(c,d,e){return this.get(c,d,e||1,'prev')},first:function(c,d,e){return this.get(c,d,e||1)},range:function(){return new Promise(function(c,d){var e=[null,null];this.first(null,null,1).then(function(g){e[0]=g[this.mount][0][this.indexKey],this.last(null,null,1).then(function(h){e[1]=h[this.mount][0][this.indexKey],c(e)}.bind(this)).catch(d)}.bind(this)).catch(d)}.bind(this))},delete:function(c){return this.dbPromise.then(function(d){for(var e=d.transaction(this.indexKey,'readwrite'),g=c.length-1;0<=g;g--)void 0!==c[g][this.indexKey]&&e.objectStore(this.indexKey).delete(c[g][this.indexKey]);return e.complete}.bind(this)).catch(function(d){return console.log(d,d.name),{}})},clear:function(){return this.dbPromise.then(function(c){var d=c.transaction(this.indexKey,'readwrite');return d.objectStore(this.indexKey).clear(),d.complete}.bind(this)).catch(function(c){return console.log(c),{}})},getAll:function(){return this.dbPromise.then(function(c){var d=c.transaction(this.indexKey),e=d.objectStore(this.indexKey),g={};g[this.mount]=[];var h=[];return e.getAll().then(function(j){h=j}),d.complete.then(function(){return g[this.mount]=h,g}.bind(this))}.bind(this)).catch(function(c){console.log(c);var d={};return d[this.mount]=[],d})},getAllKeys:function(){return this.dbPromise.then(function(c){var d=c.transaction(this.indexKey),e=[],g=d.objectStore(this.indexKey);return(g.iterateKeyCursor||g.iterateCursor).call(g,function(h){h&&(e.push(h.key),h.continue())}),d.complete.then(function(){var h={};return h[this.mount]=e,h}.bind(this))}.bind(this)).catch(function(c){console.log(c);var d={};return d[this.mount]=[],d})}},self&&(self.ClientDatabase=a)}();