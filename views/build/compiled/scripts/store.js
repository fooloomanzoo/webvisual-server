importScripts('/scripts/cache.js'),importScripts('/scripts/database.js'),self&&!(self.Promise&&self.Promise.all)&&importScripts('/bower_components/es6-promise/es6-promise.auto.min.js'),function(){function a(a,b,c){this.type=a,this.indexKey=b,this.options=c,this._store=new Map}a.prototype={has:function(a){return this._store.has(a)},get:function(a){return this._store.get(a)},add:function(a){this._store.has(a)||this._store.set(a,this._newStoreKey(a))},_newStoreKey:function(a){switch(this.type){case'database':return new ClientDatabase(a,this.indexKey,this.options);case'cache':return new ClientCache(a,this.indexKey,this.options);}},clear:function(){this._store.forEach(function(a){a.clear()}),this._store.clear()},place:function(a){for(var b in a){this.add(b);try{this._store.get(b).set(a[b])}catch(a){console.log(b,a)}}},delete:function(a){for(var b in a){this.add(b);try{this._store.get(b).delete(a[b])}catch(a){console.log(b,a)}}},request:function(a){var b={};return new Promise(function(c){if(a.mounts===void 0||!Array.isArray(a.mounts))this._store.forEach(function(c,d){b[d]=c.get(a.start,a.end,a.length)});else for(var d=0;d<a.mounts.length;d++)b[a.mounts[d]]=[],this._store.has(a.mounts[d])&&(b[a.mounts[d]]=this._store.get(a.mounts[d]).get(a.start,a.end,a.length));c(b)}.bind(this))},min:function(a){return this._operation('min',this._min,a.key,a.mounts)},max:function(a){return this._operation('max',this._max,a.key,a.mounts)},first:function(a){return this._operation('first',this._min,'x',a.mounts)},last:function(a){return this._operation('last',this._max,'x',a.mounts)},range:function(a){return a.key?new Promise(function(b){b([this.min(a),this.max(a)])}.bind(this)):new Promise(function(b){b([this.first(a),this.last(a)])}.bind(this))},_operation:function(a,b,c,d){var e=[];if(Array.isArray(d))for(var f=0;f<d.length;f++)this._store.has(d[f])&&e.push(this._store.get(d[f])[a](c));else this._store.forEach(function(b,d){d[a](c).then(function(a){e.push(a)}).catch(function(a){console.log(a)})});return b(e,c)},_max:function(c){for(var d,a,b=-1,e=c.length;++b<e;)if(null!==(a=c[b])&&a>=a){d=a;break}for(;++b<e;)null!==(a=c[b])&&d<a&&(d=a);return d},_min:function(c){for(var d,a,b=-1,e=c.length;++b<e;)if(null!==(a=c[b])&&a>=a){d=a;break}for(;++b<e;)null!==(a=c[b])&&d>a&&(d=a);return d}},self?self.Store=a:window&&(window.Store=a)}();