<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="webvisual-button.html">

<link rel="import" href="shared-styles.html">

<dom-module id="webvisual-home">

  <template include="shared-styles">

    <style>
      :host {
        @apply(--layout-vertical);
        @apply(--layout-justified);
        height: 100%;
        box-sizing: border-box;
        color: var(--bright-text-color);
        outline: none;
      }
      .box {
        position: relative;
        box-sizing: border-box;
        font-size: 1em;
        padding: 32px;
        margin: auto;
        align-self: center;
        white-space: normal;
        line-height: 1.4;
      }
      .item {
        color: var(--hightlight-color);
        display: flex;
        font-size: 1em;
        white-space: pre-line;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        text-align: center;
      }
      h1 {
        font-weight: normal;
        font-size: 2em;
        margin: 1.5em;
        text-align: center;
        white-space: normal;
      }
      a {
        display: inline-flex;
        align-items: center;
        text-decoration: none;
        width: 100%;
      }
      .item.facility {
        margin: 16px;
        padding: 1.5em;
        border-radius: 16px;
        border: thin solid var(--highlight-color);
      }
      .item.facility.iron-selected,
      .item.facility.iron-selected:hover {
        font-size: 1.25em;
        background: var(--bright-primary-color);
        border-width: medium;
      }
      .item.system {
        margin: 0 25%;
        box-sizing: border-box;
        width: 100%;
        padding: 1em;
        border-radius: 8px;
        color: var(--highlight-color);
        border: thin solid var(--highlight-color);
      }
      .item.system:hover {
        color: var(--bright-text-color);
      }
      iron-collapse {
        margin-bottom: 32px;
      }


      @media (max-width: 767px) {

      }
      a:link {
        color: var(--bright-text-color);
      }
      a:active {
        color: var(--active-link-color);
      }
      a:visited {
        color: var(--highlight-color);
      }
    </style>

    <template is="dom-if" if="[[!loggedIn]]">
      <app-toolbar>
        <a href="/login">
          <webvisual-icon-button icon="assignment-ind" class="login-icon"></webvisual-icon-button>
          <span>Bitte einloggen</span>
        </a>
      </app-toolbar>
    </template>

    <template is="dom-if" if="[[_shouldRenderBox]]">
      <div class="box">
        <header>
          <h1>Auswahl der Messanlage</h1>
        </header>
        <iron-selector id="selector" selected="{{currentFacility}}" attr-for-selected="item-name" selectable=".facility">
          <template is="dom-repeat" items="[[facilities]]" strip-whitespace>
            <webvisual-button raised class="item facility" item-name="[[item.name]]" aria-label$="[[item.title]]" tabindex="1">
              <div>[[item.title]]</div>
            </webvisual-button>

            <iron-collapse opened="{{_computeOpened(item.name, currentFacility)}}">
              <div class="collapse-content">
                <template is="dom-repeat" items="[[item.systems]]" as="system" strip-whitespace>
                  <a href$="/list/[[item.name]]/[[system.name]]" tabindex="-1">
                    <webvisual-button raised class="item system" aria-label$="[[system.title]]" tabindex="1">
                      <div>[[system.title]]</div>
                    </webvisual-button>
                  </a>
                </template>
              </div>
            </iron-collapse>
          </template>
        </iron-selector>

      </div>
    </template>

  </template>

  <script>

    Polymer({

      is: 'webvisual-home',

      properties: {

        facilities: {
          type: Array
        },

        currentFacility: {
          type: String,
          notify: true
        },

        visible: {
          type: Boolean,
          observer: '_visibleChanged'
        },

        loggedIn: {
          type: Boolean
        },

        _shouldRenderBox: {
          type: Boolean,
          computed: '_computeShouldRenderBox(facilities)'
        }
      },

      _visibleChanged: function(visible) {
        if (visible) {
          this.fire('change-section', { title: 'Home' });
        }
      },

      _computeOpened: function(name, selected) {
        return (name === selected);
      },

      _computeShouldRenderBox: function(facilities){
        return facilities && facilities.length > 0;
      }
    });

  </script>

</dom-module>
