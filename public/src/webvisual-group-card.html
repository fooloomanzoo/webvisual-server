<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="behaviors/container-behavior.html">

<link rel="import" href="webvisual-element-svg.html">
<link rel="import" href="webvisual-element-chart.html">
<link rel="import" href="webvisual-element-table.html">
<link rel="import" href="webvisual-icon-button.html">

<dom-module id='webvisual-group-card'>
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        box-sizing: border-box;
        -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
        -webkit-touch-callout: none; -webkit-tap-highlight-color:rgba(0,0,0,0);
        background: #e5e5e5;
        border: none;
      }
      :host([dark]) {
        background: #959595;
      }
      #header {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        box-sizing: border-box;
        border-top-left-radius: inherit;
        border-top-right-radius: inherit;
        background: var(--bright-primary-color);
        color: var(--bright-text-color);
        font-size: 1em;
        height: auto;
      }
      :host([dark]) > #header {
        background: var(--dark-primary-color);
        color: var(--highlight-color);
      }
      #background {
        position: absolute;
        overflow: hidden;
        left: 0; top: 0; right: 0; bottom: 0;
        border-top-left-radius: inherit;
        border-top-right-radius: inherit;
        background: linear-gradient(to top, rgba(255,255,255,0.05) 30%,rgba(255,255,255,0.25) 90%)
      }
      #title {
        cursor: pointer;
        position: absolute;
        left: 0;
        bottom: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 1em;
        padding: 0.6em 0.8em;
        box-sizing: border-box;
        color: white;
        text-transform: none;
      }
      :host(:not([opened])) #title {
        right: 0;
      }
      :host([dark]) #title {
        color: var(--highlight-color);
      }
      #mainContent {
        flex-direction: row;
        display: flex;
        position: relative;
        box-sizing: border-box;
        flex-wrap: wrap;
        align-items: flex-start;
        justify-content: space-around;
        border-top-width: thin;
        border-top-style: solid;
        border-top-color: inherit;
        padding-left: 0.5em;
        background: none;
        height: auto;
        width: auto;
        pointer-events: none;
        transition: padding 250ms cubic-bezier(0.6, 0, 0.2, 1);
      }
      #mainContent ::content > * {
        margin: 0 0.5em 0.5em 0;
        pointer-events: auto;
      }
      :host(:not([opened])) #mainContent {
        padding-top: 2.6em;
      }
      :host([opened]) #mainContent {
        padding-top: calc(15vh + 120px + 0.4em);
      }
      :host(:not([opened])) #header {
        height: 2.6em;
      }
      :host([opened]) #header {
        height: calc(15vh + 120px);
      }
      #headerContent,
      #headerContent ::content .header {
        height: 100%;
        width: 100%;
        position: relative;
      }

      :host(:not([title])),
      :host([without-window]),
      :host([without-window]) #header,
      :host([without-window]) #background {
        background: transparent !important;
        box-shadow: none !important;
        border-color: transparent !important;
      }
      :host(:not([title])) {
        max-width: none;
      }
      :host(:not([title])) > #mainContent {
        align-items: center;
        justify-content: flex-start;
      }
      [hidden] {
        display: none !important;
      }
      :host(:not([opened])) #headerContent {
        display: none;
      }
    </style>

      <section id='header' hidden$='[[_hidetitle(title, withoutWindow, hideHeader)]]'>
        <section id="background"></section>

        <iron-pages id="headerContent" selected="[[view]]" attr-for-selected="name" selected-attribute="opened">
          <webvisual-element-table name="table" item="[[item]]"></webvisual-element-table>
          <template is="dom-if" if="[[svgSource]]">
            <webvisual-element-svg name="svg" source="[[svgSource]]" selectable="svgSelectable" item="[[item]]" exceeding="[[exceeding]]"></webvisual-element-svg>
          </template>

          <webvisual-element-chart name="chart" item="[[item]]" items="[[item]]" exceeding="[[exceeding]]"></webvisual-element-chart>
        </iron-pages>

        <section id='title' on-tap='toggle'>
          <span>[[title]]</span>
          <iron-selector selected="{{view}}" attr-for-selected="name">
            <webvisual-icon-button icon="assessment" name="table"></webvisual-icon-button>
            <template is="dom-if" if="[[svgSource]]">
              <webvisual-icon-button icon="view-module" name="svg"></webvisual-icon-button>
            </template>
            <webvisual-icon-button icon="juelich:graph-inverted" name="chart"></webvisual-icon-button>
          </iron-selector>

        </section>
      </section>

      <section id='mainContent'>
        <content></content>
      </section>

  </template>
  <script>
    WebvisualGroupCard = Polymer({
      is: 'webvisual-group-card',

      behaviors: [
        ContainerBehavior
      ],

      properties: {

        title: {
          type: String,
          value: '',
          reflectToAttribute: true,
          observer: '_titleChanged'
        },

        opened: {
          type: Boolean,
          reflectToAttribute: true
        },

        svgSelectable: Object,

        svgSource: String

      },

      observers: [
        '_exceedingChanged(exceedingElements.splices)'
      ],

      toggle: function() {
        if (!this.opened) {
          this.open();
        }
        else {
          this.close();
        }
      },

      open: function() {
        this.opened = true;
      },

      close: function() {
        this.opened = false;
      },

      _titleChanged: function(title) {
        if (!title) {
          this.title = 'unknown';
          this.$.title.style.color = 'transparent';
          return;
        } else {
          this.$.title.style.color = '';
        }
        this.setAttribute('aria-system', title);
      },

      _hidetitle: function(title, withoutWindow, hideHeader) {
        if (withoutWindow || hideHeader)
          return true;
        else
          return false;
      }

    });
  </script>
</dom-module>
