<html><head><link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="behaviors/color-behavior.html">

<link rel="import" href="behaviors/device-behavior.html">

<link rel="import" href="style/device-shared-style.html">

<script type="text/javascript" src="../bower_components/d3/d3.min.js"></script>


</head><body><dom-module id="device-graph">
    <template>
    <style include="device-shared-style"></style>
  </template>
    <script>DiagramGraph=Polymer({is:"device-graph",behaviors:[WebvisualBehaviors.ColorBehavior,WebvisualBehaviors.DeviceBehavior],properties:{interpolation:{type:String,value:"Lineare Verbindung",observer:"_interpolationChanged"},noDots:Boolean,noLine:Boolean,noFill:Boolean,lineWidth:{type:Number,value:.75,observer:"_lineWidthChanged"},dotRadius:{type:Number,value:3,observer:"_dotRadiusChanged"},viewLength:{type:Number,value:Number.POSITIVE_INFINITY},storeInside:{type:Boolean,value:!0,readOnly:!0}},chartElement:Object,area:Object,_isAttached:!1,get containerRoot(){var t=Polymer.dom(this).getOwnerRoot();return t?t.nodeType==Node.DOCUMENT_FRAGMENT_NODE?t.host:void 0:Polymer.dom(this).parentNode},observers:["_itemChanged(item)","_presentationChanged(noDots, noLine, noFill)"],created:function(){this.area=d3.area().defined(this._defined.bind(this)).x(function(t){return this.chartElement._x(t.x)}.bind(this)).y0(function(){return"ln"===this.chartElement.yScale||"log₁₀"===this.chartElement.yScale?this.chartElement._height:this.chartElement._y(0)}.bind(this)).y1(function(t){return this.chartElement._y(t.y)}.bind(this)),this.bisectDate=d3.bisector(function(t){return t.x}).left},attached:function(){this.item&&this.addNodes()},detached:function(){this.removeNodes(),this.chartElement=null},addNodes:function(){this._isAttached&&this.clearValues(!0);var t=this.containerRoot;if(!t||"DEVICE-CHART"!==t.nodeName)return void console.warn("No parentElement (chart) for graph found. Registration of Graph Element failed");this.chartElement=t,this.chartElement._height&&this.chartElement._width||this.chartElement._sizeLayout(),this.chartElement._graphs.add(this),this.noDots=this.chartElement.noDots||!1,this.noLine=this.chartElement.noLine||!1,this.noFill=this.chartElement.noFill||!1,this.areaNode&&this.areaNode.node?this.areaNode.attr("data-name",this.item.mount).attr("fill",this.noFill?null:this.item.color||"#000").attr("stroke",this.noLine?null:this.item.color||"#000").attr("stroke-width",this.lineWidth):this.areaNode=this.chartElement._areas.append("svg:path").attr("data-name",this.item.mount).attr("class","area").attr("fill",this.noFill?null:this.item.color||"#000").attr("stroke",this.noLine?null:this.item.color||"#000").attr("stroke-width",this.lineWidth),this.areaNode.datum([]).attr("d",this.area);var e,i=this.chartElement._bounderies;this.item.threshold?(this.bounderyLineGradientNode=i.append("linearGradient").attr("id","boundery-line-"+this.item.mount).attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",this.chartElement._height).attr("x2",0).attr("y2",0),this.areaNode.attr("stroke","url(#boundery-line-"+this.item.mount+")")):this.bounderyLineGradientNode&&this.bounderyLineGradientNode.node&&(e=this.bounderyLineGradientNode.node(),e&&e.parentElement&&e.parentElement.removeChild(e),this.bounderyLineGradientNode=null),this.dots&&this.dots.node?this.dots.attr("mount",this.item.mount).attr("hidden",!!this.noDots||null):this.dots=this.chartElement._dots.append("svg:g").attr("mount",this.item.mount).attr("class","dots").attr("hidden",!!this.noDots||null),this._isAttached=!0,this.chartElement.redraw()},removeNodes:function(){var t;this.areaNode&&this.areaNode.node&&(t=this.areaNode.node(),t&&t.parentElement&&t.parentElement.removeChild(t),this.areaNode=null),this.dots&&this.dots.node&&(t=this.dots.node(),t&&t.parentElement&&t.parentElement.removeChild(t),this.dots=null),this.bounderyLineGradientNode&&this.bounderyLineGradientNode.node&&(t=this.bounderyLineGradientNode.node(),t&&t.parentElement&&t.parentElement.removeChild(t),this.bounderyLineGradientNode=null),this.chartElement&&this.chartElement._graphs&&this.chartElement._graphs.delete(this),this._isAttached=!1},_itemChanged:function(t){t&&t.mount&&this.addNodes()},insertValues:function(t,e){if(void 0!==t){var e=e||(this.viewLength>0?this.viewLength:t.length);if(this._initialized||(this._initialized=!0),e){var i=t.slice(t.length-e,t.length);i.map(function(t){return{x:new Date(t.x),y:+t.y,state:+t.state}}),this.storeInside&&(this.values=this.values.concat(i)),this.renderInsertedValues(i),i.length=0}else t.map(function(t){return{x:+t.x,y:+t.y,state:+t.state}}),this.storeInside&&(this.values=this.values.concat(t)),this.renderInsertedValues(t)}},spliceValues:function(t){for(var e=0;e<t.length;e++){for(var i=this.values.length-1;i>=0&&this.values[i].x!==t[e].x;i--);i!==-1&&this.values.splice(i,1)}this.redraw()},renderInsertedValues:function(t){this.chartElement||(this.chartElement=this.containerRoot),this.chartElement&&(this.chartElement._isZoomed===!1?this.chartElement.redraw():this.redraw())},redraw:function(){this.chartElement&&this.chartElement.opened&&this.item&&this.values&&this.values.length&&this.async(function(){var t=this.values||[];if(!this.noFill){if(!this.areaNode||!this.areaNode.node)return this.item&&this.item.mount?void this.addNodes():void 0;this.areaNode.datum(t).attr("d",this.area)}var e;if(this.item.threshold&&this.bounderyLineGradientNode&&this.bounderyLineGradientNode.node){var i=[],r=this.customStyle["device-state-exceeds-color"]||"#F20C0C",a=this.customStyle["device-state-deceeds-color"]||"#F20C0C",n=this.item.color||"#000";void 0!==this.item.threshold.from&&(e=100*(1-Math.ceil(this.chartElement._y(this.item.threshold.from)+1.25*this.lineWidth)/this.chartElement._height),Number.isFinite(e)&&(i.push({o:e+"%",c:a}),i.push({o:e+"%",c:n}))),void 0!==this.item.threshold.to&&(e=100*(1-Math.floor(this.chartElement._y(this.item.threshold.to)-1.25*this.lineWidth)/this.chartElement._height),Number.isFinite(e)&&(i.push({o:e+"%",c:n}),i.push({o:e+"%",c:r})));var s=this.bounderyLineGradientNode.attr("x1",0).attr("y1",this.chartElement._height).attr("x2",0).attr("y2",0).selectAll("stop").data(i);s.attr("offset",function(t){return t.o}).attr("stop-color",function(t){return t.c}),s.enter().append("stop").attr("offset",function(t){return t.o}).attr("stop-color",function(t){return t.c}),s.exit().remove()}}.bind(this))},_defined:function(t,e,i){var r=this.chartElement._x.domain(),a=this.chartElement.yScale;return!!Number.isFinite(t.y)&&(("ln"!==a&&"log₁₀"!==a||!(t.y<=0))&&!!(t.x>=r[0]&&t.x<=r[1]||i[e+1]&&i[e+1].x>=r[0]&&i[e+1].x<=r[1]||i[e-1]&&i[e-1].x>=r[0]&&i[e-1].x<=r[1]))},setColor:function(t){WebvisualBehaviors.ColorBehavior.setColor.call(this,t),this.chart&&this.areaNode&&this.areaNode.attr&&this.areaNode.attr("fill",t)},clearValues:function(t){WebvisualBehaviors.DeviceBehavior.clearValues.call(this,t)},_getStrokeColor:function(t){if(this.item.threshold)switch(t.state){case 1:return this.customStyle["device-state-exceeds-color"]||"#F20C0C";case-1:return this.customStyle["device-state-deceeds-color"]||"#F20C0C"}return this.item.color||"#fff"},_presentationChanged:function(t,e,i){this.areaNode&&this.areaNode.attr&&(this.areaNode.attr("fill",this.noFill?this.item.color||"#000":null).attr("stroke",this.noLine?"#000":null),this.debounce("redraw",this.redraw,16))},_dotRadiusChanged:function(t){this.dots&&this.dots.selectAll&&this.dots.selectAll("circle.dot").attr("r",t)},_lineWidthChanged:function(t){this.areaNode&&this.areaNode.attr&&this.areaNode.attr("stroke-width",t)},_interpolationChanged:function(t){var e;switch(t){case"Basis Spline":e=d3.curveBasis;break;case"Monotoner Spline":e=d3.curveMonotoneX;break;case"Kubischer Spline":e=d3.curveNatural;break;case"Cardinaler Spline":e=d3.curveCardinal;break;case"Catmull-Rom-Spline":e=d3.curveCatmullRom;break;case"Stufe (mitte)":e=d3.curveStep;break;case"Stufe (davor)":e=d3.curveStepAfter;break;case"Stufe (danach)":e=d3.curveStepBefore;break;default:e=d3.curveLinear}this.area.curve(e),this.chartElement&&this.areaNode&&this.redraw()}});</script>

</dom-module>
</body></html>