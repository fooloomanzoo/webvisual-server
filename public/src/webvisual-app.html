<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/effects/resize-snapped-title.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/helpers/helpers.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="style/app-theme.html"/>
<link rel="import" href="style/form-styles.html"/>
<link rel="import" href="style/webvisual-app-style.html"/>
<link rel="import" href="behaviors/container-behavior.html"/>
<link rel="import" href="behaviors/attribute-repeat-animation-behavior.html"/>

<link rel="import" href="webvisual-logo.html"/>
<link rel="import" href="webvisual-icon-button.html"/>
<link rel="import" href="webvisual-facility-data.html"/>
<link rel="import" href="webvisual-home.html"/>
<link rel="import" href="webvisual-select.html"/>
<link rel="import" href="webvisual-list.html"/>

<link rel="import" href="../bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"/>
<link rel="import" href="../bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"/>
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html"/>
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html"/>
<link rel="import" href="../bower_components/neon-animation/neon-shared-element-animatable-behavior.html"/>
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html"/>
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html"/>
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html"/>
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html"/>
<link rel="import" href="../bower_components/neon-animation/animations/slide-up-animation.html"/>
<link rel="import" href="../bower_components/neon-animation/animations/hero-animation.html"/>

<dom-module id="webvisual-app">

  <template>
    <style include="app-theme"></style>
    <style include="webvisual-app-style">
      :host {
        font-size: 1em;
        display: block;
        position: relative;
        padding-top: 130px;
        padding-bottom: 64px;
        min-height: 100vh;
        --app-primary-color: var(--primary-color);
        --app-secondary-color: var(--dark-primary-color);
        --app-accent-color: var(--bright-primary-color);
        --paper-button-ink-color: var(--app-accent-color);
        --paper-icon-button-ink-color: var(--app-accent-color);
        --paper-spinner-color: var(--app-accent-color);
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        color: var(--primary-text-color);
      }
      app-header {
        @apply(--layout-fixed-top);
        z-index: 1;
        background-color: rgba(255, 255, 255, 0.95);
        --app-header-shadow: {
          box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.2);
          height: 10px;
          bottom: -10px;
        };
      }
      app-toolbar {
        font-size: 16px;
        background: var(--primary-color);
        color: var(--bright-text-color);
      }
            /* small screen */
      @media (max-width: 767px) {
        :host {
          padding-top: 64px;
        }

        .menu-btn {
          display: block;
        }

        :host([page=detail]) .menu-btn {
          display: none;
        }
      }
      #toolbarFooter ::content .toolbar-footer {
        border-width: 0;
        border-color: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        box-sizing: border-box;
        padding: 0;
        padding-right: 1px;
        margin: 0;
        z-index: inherit;
        /*height: 0;*/
        position: relative;
      }
      #toolbarFooter ::content .toolbar-footer[opened] {
        /*height: 100%;*/
      }
      #toolbarFooter ::content .toolbar-footer:last-child {
        padding-right: 0;
      }
      #toolbarFooter ::content svg-element {
        background: rgba(255,255,255,0.2);
      }
      #groupingKeysSystemSelector {
        display: flex;
        flex-direction: column;
      }
      #groupingKeysSystemSelector ::content iron-selector.groupingKeySelector {
        display: flex;
        flex-direction: column;
      }
      #groupingKeysSystemSelector ::content iron-selector.groupingKeySelector:not(.foreground) {
        display: none !important;
      }
      #groupingKeysSystemSelector ::content radio-webvisual-button {
        font-size: 0.9em;
        padding: 0.5em;
      }
      #systemsTabs {
        height: 34px;
        font-size: 0.85em;
  			align-self: flex-end;
  			margin-left: 24px;
  			margin-right: 60px;
      }
      #systemsTabs ::content tab-element.system.iron-selected {
        background: linear-gradient(to top, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15));
        color: #f1f1f1;
      }
      #systemsTabs ::content tab-element.system:hover:not(.iron-selected) {
        background: linear-gradient(to top, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.04));
      }
      #systemsTabs ::content tab-element.system.iron-selected[dark] {
        background: linear-gradient(to top, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.08));
        color: #A8CCDB;
      }

  		#control webvisual-icon-button.tab-icon {
  			display: none !important;
  		}
      @media all and (max-width: 520px) {
  			#toolbarHeader {
  				flex-direction: column;
  			}
  			#systemsTabs {
  				align-self: flex-start;
  				display: none !important;
  			}
  			#systemsTabs.tabs-opened {
  				display: inline-block !important;
  			}
  			#control webvisual-icon-button.tab-icon {
  				display: inline-block !important;
  			}
        #panelSelector ::content .panel {
          display: block;
          padding: 0em;
        }
        #toolbarHeader webvisual-icon-button.menu-icon {
          margin-left: 12px;
        }

      }
      @media all and (min-width: 520px) and (max-width: 600px){
        #toolbarHeader webvisual-icon-button.menu-icon {
          margin-left: 16px;
        }
      }
    </style>

    <app-location route="{{facility}}"></app-location>
    <app-route
      route="{{facility}}"
      pattern="/:page"
      data="{{routeData}}"
      tail="{{subroute}}"></app-route>

    <webvisual-facility-data facilities="{{facilities}}"></webvisual-facility-data>

    <iron-media-query query="max-width: 767px" query-matches="{{smallScreen}}"></iron-media-query>

    <app-header role="navigation" id="header" effects="waterfall resize-snapped-title" condenses fixed>
      <app-toolbar>
        <webvisual-icon-button icon="menu" class="menu-icon" on-tap="toggleDrawer"></webvisual-icon-button>

          <webvisual-logo main-title id="logo" on-tap="backToIndex"></webvisual-logo>
          <div condensed-title>Webvisual</div>

        <section id="control" bottom-item>
  				<section id="tabsIcon">
  					<webvisual-icon-button icon="more-vert" class="tab-icon" on-tap="toggleTabs"></webvisual-icon-button>
  				</section>
          <webvisual-icon-button icon="error-outline" class="error control" on-tap="toggleAlarmPanel" hidden$="[[!isExceeding]]"></webvisual-icon-button>
          <section hidden$="[[!_computeOpened(opened, forceOpened)]]" style="display: flex;">
            <webvisual-icon-button icon="[[_computeExpandIcon(expanded)]]" class="expand-icon" on-tap="toolbarExpandToggle"></webvisual-icon-button>
            <webvisual-icon-button icon="remove" hidden$="[[forceOpened]]" class="toggle-icon control" on-tap="closeToolbar"></webvisual-icon-button>
          </section>
        </section>
      </app-toolbar>

      <!-- <app-toolbar id="systemsTabs" sticky$="[[_shouldShowTabs]]" hidden$="[[!_shouldShowTabs]]"> -->
        <div id="tabContainer">
          <template is="dom-if" if="[[_shouldRenderTabs]]">
            <webvisual-tabs
                selected="[[currentFacility]]"
                attr-for-selected="name">
              <template is="dom-repeat" items="[[facilities]]" as="facility" initial-count="3">
                <webvisual-tab name="[[facility.name]]">
                  <a href="/list/[[facility.name]]">[[facility.title]]</a>
                </webvisual-tab>
              </template>
            </webvisual-tabs>
          </template>
        </div>
        <!-- <div id="tabContainer" sticky$="[[_shouldShowTabs]]" hidden$="[[!_shouldShowTabs]]">
          <template is="dom-if" if="[[_shouldRenderTabs]]">
            <webvisual-tabs
                selected="[[currentSystem]]"
                attr-for-selected="name">
              <template is="dom-repeat" items="[[systems]]" as="system">
                <webvisual-tab name="[[system.name]]">
                  <a href="/list/[[currentFacility.name]]/[[system.name]]">[[system.title]]</a>
                </webvisual-tab>
              </template>
            </webvisual-tabs>
          </template>
        </div> -->
        <!-- <iron-selector id="systemSelector" selected="{{currentSystem}}" attr-for-selected="system">
          <content select="tab-element.system"></content>
        </iron-selector> -->
      <!-- </app-toolbar> -->

      <app-toolbar sticky>
        <!-- <iron-selector id="systemSelector" selected="{{currentSystem}}" attr-for-selected="system">
          <content select="tab-element.system"></content>
        </iron-selector> -->
      </app-toolbar>

    </app-header>

    <!-- <iron-pages role="main" id="panelSelector" selected="{{currentSystem}}" attr-for-selected="system"> -->
    <iron-pages role="main" selected="[[page]]" attr-for-selected="name" selected-attribute="visible">
      <!-- home view -->
      <webvisual-home name="home" facilities="[[facilities]]"></webvisual-home>
      <!-- list view of items in a category -->
      <webvisual-select name="system-select" route="[[subroute]]" offline="[[offline]]"></webvisual-select>
      <!-- detail view of one item -->
      <webvisual-list name="list" route="[[subroute]]" offline="[[offline]]"></webvisual-list>
    </iron-pages>

    <!-- EXCEEDING -->
    <!-- <app-drawer id="alarmPanel">
      <section id="alarmHeader" on-tap="toggleAlarmPanel">
        <webvisual-button class="title"><iron-icon icon="warning" class="left"></iron-icon><section class="content">Alarme</section></webvisual-button>
      </section>

      <webvisual-swipeable-container id="exceedingElementsList"
         is-exceeding="{{isExceeding}}"
         notify-parent="{{!noExceedNotify}}"
         no-select-notify
         no-auto-removal-exceeding-elements>
      </webvisual-swipeable-container>

      <section style="padding: 0em 0.75em 0.75em 0.75em; float: right;"><a href="#" on-click="_clearExceedingElementsFromList">Liste leeren</a></section>
    </app-drawer> -->

    <!-- SIDEMENU -->
    <app-drawer id="drawerPanel">
      <webvisual-button collapse-id="settings" class="sidemenu collapsable" on-tap="toggleCollapse">
        <iron-icon icon="settings" class="left"></iron-icon>
        <section class="content">Einstellungen</section>
        <iron-icon icon="arrow-drop-up" class="right" id="settings"></iron-icon>
      </webvisual-button>

          <section class="sidemenu indention collapse settings" opened>
            <webvisual-button collapse-id="grouping" class="sidemenu" on-tap="toggleCollapse">
              <iron-icon icon="reorder" class="left"></iron-icon>
              <section class="content">Gruppierung</section>
              <iron-icon icon="arrow-drop-down" class="right" id="grouping"></iron-icon>
            </webvisual-button>
            <section id="groupingKeysButtons" class="sidemenu indention collapse grouping">
              <iron-selector id="groupingKeysSystemSelector" selected="[[currentSystem]]" attr-for-selected="system" selected-class="foreground">
                <content select="iron-selector.groupingKeySelector"></content>
              </iron-selector>
            </section>

            <webvisual-toggle-button class="sidemenu" on-change="toggleDateView"><iron-icon icon="date-range"></iron-icon>Zeit anzeigen</webvisual-toggle-button>
            <webvisual-toggle-button class="sidemenu" on-change="toggleWindowDecoration" checked="{{withoutWindow}}"><iron-icon icon="editor:border-style"></iron-icon>Fensterrahmen</webvisual-toggle-button>
            <webvisual-toggle-button class="sidemenu" on-change="toggleWindowHeader" checked="{{hideHeader}}"><iron-icon icon="editor:drag-handle"></iron-icon>Fenstertitel</webvisual-toggle-button>
            <webvisual-toggle-button class="sidemenu" id="colorschema" on-change="toggleTheme"><iron-icon icon="settings-brightness"></iron-icon>Farbschema</webvisual-toggle-button>
          </section>

      <webvisual-button class="sidemenu" on-tap="backToSelectPage">
        <iron-icon icon="assessment" class="left"></iron-icon>
        <section class="content">Konfigurationsauswahl</section>
      </webvisual-button>

      <webvisual-button class="sidemenu" on-tap="backToIndex">
        <iron-icon icon="arrow-back" class="left"></iron-icon>
        <section class="content">Index</section>
      </webvisual-button>

    </app-drawer>

  </template>

  <script>
    Polymer({
      is: 'webvisual-app',

      properties: {

        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        },

        numItems: {
          type: Number,
          value: 0
        },

        _shouldShowTabs: {
          computed: '_computeShouldShowTabs(page, smallScreen)'
        },

        _shouldRenderTabs: {
          computed: '_computeShouldRenderTabs(_shouldShowTabs, loadComplete)'
        },

        _shouldRenderDrawer: {
          computed: '_computeShouldRenderDrawer(smallScreen, loadComplete)'
        }
      },

      observers: [
        '_routePageChanged(routeData.page)'
      ],

      listeners: {
        'change-section': '_onChangeSection',
        'announce': '_onAnnounce',
        'dom-change': '_domChange'
      },

      created: function() {
        window.performance && performance.mark && performance.mark('webvisual-app.created');
        // Custom elements polyfill safe way to indicate an element has been upgraded.
        this.removeAttribute('unresolved');
      },

      ready: function() {
        // listen for online/offline
        Polymer.RenderStatus.afterNextRender(this, function() {
          this.listen(window, 'online', '_notifyNetworkStatus');
          this.listen(window, 'offline', '_notifyNetworkStatus');
        });
      },

      _routePageChanged: function(page) {
        this.page = page || 'home';
        // Scroll to the top of the page on every *route* change. Use `Polymer.AppLayout.scroll`
        // with `behavior: 'silent'` to disable header scroll effects during the scroll.
        Polymer.AppLayout.scroll({ top: 0, behavior: 'silent' });
        // Close the drawer - in case the *route* change came from a link in the drawer.
        this.drawerOpened = false;
      },

      _pageChanged: function(page, oldPage) {
        if (page != null) {
          // home route is eagerly loaded
          if (page == 'home') {
            this._pageLoaded(Boolean(oldPage));
          // other routes are lazy loaded
          } else {
            this.importHref(
              this.resolveUrl('webvisual-' + page + '.html'),
              function() {
                this._pageLoaded(Boolean(oldPage));
              }, null, true);
          }
        }
      },

      _pageLoaded: function(shouldResetLayout) {
        this._ensureLazyLoaded();
        if (shouldResetLayout) {
          // The size of the header depends on the page (e.g. on some pages the tabs
          // do not appear), so reset the header's layout only when switching pages.
          this.async(function() {
            this.$.header.resetLayout();
          }, 1);
        }
      },

      _ensureLazyLoaded: function() {
        // load lazy resources after render and set `loadComplete` when done.
        if (!this.loadComplete) {
          Polymer.RenderStatus.afterNextRender(this, function() {
            this.importHref(this.resolveUrl('lazy-resources.html'), function() {
              // Register service worker if supported.
              if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js');
              }
              this._notifyNetworkStatus();
              this.loadComplete = true;
            });
          });
        }
      },

      _notifyNetworkStatus: function() {
        var oldOffline = this.offline;
        this.offline =  !navigator.onLine;
        // Show the snackbar if the user is offline when starting a new session
        // or if the network status changed.
        if (this.offline || (!this.offline && oldOffline === true)) {
          if (!this._networkSnackbar) {
            this._networkSnackbar = document.createElement('webvisual-snackbar');
            Polymer.dom(this.root).appendChild(this._networkSnackbar);
          }
          Polymer.dom(this._networkSnackbar).innerHTML = this.offline ?
              'You are offline' : 'You are online';
          this._networkSnackbar.open();
        }
      },

      _toggleDrawer: function() {
        this.drawerOpened = !this.drawerOpened;
      },

      // Elements in the app can notify section changes.
      // Response by a11y announcing the section and syncronizing the category.
      _onChangeSection: function(event) {
        var detail = event.detail;
        this.categoryName = detail.category || '';
        // Announce the page's title
        if (detail.title) {
          document.title = detail.title + ' - Webvisual';
          this._announce(detail.title + ', loaded');
        }
      },

      // Elements in the app can notify a change to be a11y announced.
      _onAnnounce: function(e) {
        this._announce(e.detail);
      },

      // A11y announce the given message.
      _announce: function(message) {
        this._a11yLabel = '';
        this.debounce('_a11yAnnouncer', function() {
          this._a11yLabel = message;
        }, 100);
      },

      // This is for performance logging only.
      _domChange: function(e) {
        if (window.performance && performance.mark && !this.__loggedDomChange) {
          var target = Polymer.dom(e).rootTarget;
          if (target.domHost.is.match(this.page)) {
            this.__loggedDomChange = true;
            performance.mark(target.domHost.is + '.domChange');
          }
        }
      },

      _computeShouldShowTabs: function(page, smallScreen) {
        return true;
        // (page === 'home' || page === 'list' || page === 'detail') && !smallScreen;
      },

      _computeShouldRenderTabs: function(_shouldShowTabs, loadComplete) {
        return _shouldShowTabs && loadComplete;
      },

      _computeShouldRenderDrawer: function(smallScreen, loadComplete) {
        return smallScreen && loadComplete;
      },

      _computePluralizedQuantity: function(quantity) {
        return quantity + ' ' + (quantity === 1 ? 'item' : 'items');
      }

    });

    //   behaviors: [
    //     Polymer.IronA11yKeysBehavior,
    //     Polymer.IronResizableBehavior,
    //     Polymer.NeonSharedElementAnimatableBehavior
    //   ],
    //
    //   properties: {
    //
    //     reproductionContainer: {
    //       type: String,
    //       value: 'toolbarFooter'
    //     },
    //
    //     animatable: {
    //       type: Boolean,
    //       reflectToAttribute: true
    //     },
    //
    //     repeatedAttributes: {
    //       type: Array,
    //       value: function() {
    //         return ['opened', 'expanded']
    //       }
    //     },
    //
    //     attributeAnimations: {
    //       type: Object,
    //       value: function() {
    //         return {
    //           'opened': {
    //             'exit': {
    //               name: 'fade-out-animation',
    //               timing: {
    //                 duration: 250
    //               }
    //             }
    //           }
    //         };
    //       }
    //     },
    //
    //     isExceeding: {
    //       type: Boolean,
    //       value: false,
    //       observer: '_handleExceeding'
    //     },
    //
    //     nativeNotification: {
    //       type: Boolean,
    //       value: false,
    //       observer: 'requestNotificationPermission'
    //     }
    //   },
    //
    //   listeners: {
    //     'neon-animation-finish': '_onNeonAnimationFinish'
    //   },
    //
    //   keyBindings: {
    //      'left': 'previousPanel', // same as 'space:keydown'
    //      'right': 'nextPanel',
    //      'down': 'contractToolbar',
    //      'up': 'expandToolbar',
    //      'esc': 'backToSelectPage'
    //    },
    //
    //   attached: function() {
    //     Polymer.dom(this.$.groupingKeysSystemSelector)
    //            .observeNodes(function(info) {
    //              for (var i in info.addedNodes)
    //               if (info.addedNodes[i].nodeName === "IRON-SELECTOR")
    //                 info.addedNodes[i].addEventListener("iron-select", function(e) {
    //                   this.regroup(e.currentTarget.selected);
    //                 }.bind(this));
    //            }.bind(this));
    //   },
    //
    //   getAnimatableNodes: function() {
    //     return this.getEffectiveChildNodes
    //                  .call(this.$.toolbarFooter)
    //                  .filter(function(el) {
    //                    return (el.nodeType === Node.ELEMENT_NODE);
    //                  });
    //   },
    //
    //   // Toolbar Actions
    //   openedChanged: function() {
    //     if (this.opened || this.forceOpened) {
    //       this.opened = true;
    //       this.$.toolbarFooter.setAttribute('opened', true);
    //     }
    //   },
    //   forceOpenedChanged: function() {
    //     if (this.opened || this.forceOpened) {
    //       if (this.opened === false) {
    //         this.opened = true;
    //       }
    //     }
    //   },
    //   toolbarExpandToggle: function() {
    //     if (this.opened || this.forceOpened) {
    //       if (this.expanded) {
    //         this.contractToolbar();
    //       } else {
    //         this.expandToolbar();
    //       }
    //     }
    //   },
    //   contractToolbar: function() {
    //     this.expanded = false;
    //   },
    //   expandToolbar: function() {
    //     if (this.opened || this.forceOpened) {
    //       this.expanded = true
    //     } else {
    //       this.opened = true;
    //     }
    //   },
    //   closeToolbar: function(newSystem, oldSystem) {
    //     this.clearSelectedElements();
    //     this.opened = false;
    //   },
    //   _onNeonAnimationFinish: function() {
    //     if (this.opened === false) {
    //       if (this.$.toolbarFooter.hasAttribute('opened')) {
    //         this.$.toolbarFooter.removeAttribute('opened');
    //       }
    //     }
    //     this.notifyResize();
    //   },
    //
    //   previousPanel: function() {
    //     this.$.panelSelector.selectPrevious();
    //   },
    //
    //   nextPanel: function() {
    //     this.$.panelSelector.selectNext();
    //   },
    //
    //   _computeOpened: function(opened, forceOpened) {
    //     return opened || forceOpened;
    //   },
    //   _computeExpandIcon: function() {
    //     if (this.expanded)
    //       return 'expand-less';
    //     else
    //       return 'expand-more';
    //   },
    //
    //   _handleExceeding: function(value) {
    //     if(value && !(this.$.alarmPanel.classList.contains("alarm-panel-opened"))) {
    //       this.openAlarmPanel();
    //       this.debounce('alarm-notification', this.createAlarmNotification, 750);
    //     }
    //     else if (this.$.exceedingElementsList.exceedingElements.length === 0) {
    //       this.debounce('close-alarm-panel', this.closeAlarmPanel, 1000);
    //     }
    //   },
    //   // app Control
    //   backToSelectPage: function() {
    //     this.clearSelectedElements();
    //     this.fire("clear-selected-elements");
    //     this.closeDrawer();
    //     this.closeToolbar();
    //     PageSelector.select("0");
    //   },
    //   backToIndex: function() {
    //     window.location.pathname = '/index';
    //   },
    //   // Panel Control
    //   _currentSystemChanged: function(newSystem, oldSystem) {
    //     // this._selectPanel(newSystem, oldSystem);
    //     this.clearSelectedElements();
    //     this.fire("clear-selected-elements");
    //   },
    //   _selectPanel: function(newSystem, oldSystem) {
    //     var newpanel = this.queryEffectiveChildren.call(this.$.panelSelector,'[system=' + newSystem + ']'),
    //         newebvisualelector = this.queryEffectiveChildren.call(this.$.groupingKeysSystemSelector,'[system=' + newSystem + ']');
    //     var oldpanel = this.queryEffectiveChildren.call(this.$.panelSelector,'[system=' + oldSystem + ']'),
    //         oldselector = this.queryEffectiveChildren.call(this.$.groupingKeysSystemSelector,'[system=' + oldSystem + ']');
    //
    //     if (newebvisualelector && newpanel) {
    //       newebvisualelector.style.display = '';
    //       newebvisualelector.classList.add("foreground");
    //       newpanel.style.display = '';
    //       newpanel.classList.add("foreground");
    //     }
    //
    //     if (this.animatable) {
    //       if (oldpanel) {
    //         oldpanel.addEventListener("transitionend", function(e) {
    //           if (newpanel)
    //             newpanel.classList.add("selected");
    //           oldpanel.classList.remove("foreground");
    //           oldpanel.removeEventListener(e.type, arguments.callee);
    //         });
    //         oldpanel.classList.remove("selected");
    //         if (oldselector)
    //           oldselector.classList.remove("foreground");
    //       }
    //       else if (newpanel) {
    //         newpanel.classList.add("selected");
    //       }
    //     }
    //     else {
    //       if (newpanel)
    //         newpanel.classList.add("selected");
    //       if (oldpanel) {
    //         oldpanel.classList.remove("foreground");
    //         oldpanel.classList.remove("selected");
    //         if (oldselector)
    //           oldselector.classList.remove("foreground");
    //       }
    //     }
    //   },
    //   // Grouping Options
    //   regroup: function(key) {
    //     var system = this.currentSystem;
    //     var panel = this.queryEffectiveChildren('.panel[system="'+system+'"]');
    //     if (panel)
    //       panel.groupedKey = key;
    //   },
    //
    //   _clearExceedingElementsFromList: function() {
    //     this.$.exceedingElementsList.clearExceedingElements();
    //     this.closeAlarmPanel();
    //   },
    //
    //   requestNotificationPermission: function() {
    //     // Notifications
    //     if (!("Notification" in window)) {
    //       console.warn("This browebvisualer does not support desktop notification");
    //     }
    //     //  ask the user for permission
    //     else if (this.notification && Notification.permission !== 'denied') {
    //       Notification.requestPermission(function (permission) {
    //         // If the user accepts, let's create a notification
    //         if (permission === "granted") {
    //           var notification = new Notification("Notifikationen aktiv", {icon: '../../img/icons/webicon.png', body: '', tag: ''});
    //         }
    //       });
    //     }
    //   },
    //
    //   createAlarmNotification: function() {
    //     if (Notification.permission !== 'denied') {
    //       var count = this.exceedingElements.length;
    //       var msg = '';
    //
    //       var notification = new Notification(count + ' Elemente im Alarmzustand',
    //         { icon: '../../img/icons/warning.png',
    //           body: msg,
    //           tag: msg });
    //     }
    //   },
    //
    //   toggleTheme: function(){
    //     var elems = document.querySelectorAll('*');
    //     if(this.dark === true) {
    //       for (i = 0; i < elems.length; ++i) {
    //         elems[i].removeAttribute("dark");
    //       }
    //       this.set("dark", false);
    //     }
    //     else {
    //       for (i = 0; i < elems.length; ++i) {
    //         elems[i].setAttribute("dark", '');
    //       }
    //       this.set("dark", true);
    //     }
    //     this.updateStyles();
    //   },
    //   toggleWindowDecoration: function(){
    //     var elems = document.querySelectorAll('webvisual-group-card');
    //     for (i = 0; i < elems.length; ++i) {
    //       elems[i].toggleAttribute("without-window");
    //     }
    //   },
    //   toggleWindowHeader: function(){
    //     var elems = document.querySelectorAll('webvisual-group-card');
    //     for (i = 0; i < elems.length; ++i) {
    //       elems[i].toggleAttribute("hide-header");
    //     }
    //   },
    //   toggleDateView: function(){
    //     var elems = document.querySelectorAll('[updatable]');
    //     for (i = 0; i < elems.length; ++i) {
    //       elems[i].toggleAttribute("show-date");
    //     }
    //   },
    //   toggleCollapse: function(e){
    //     var button = e.currentTarget;
    //     if (!button.hasAttribute('collapse-id')) {
    //       return;
    //     }
    //     var id = button.getAttribute('collapse-id');
    //     var collapse = Polymer.dom(this.root).querySelector('section.collapse.'+id);
    //     var iconbutton = Polymer.dom(button).querySelector('iron-icon.right');
    //     if (collapse) {
    //       if (collapse.hasAttribute('opened')) {
    //         collapse.removeAttribute('opened')
    //       } else {
    //         collapse.setAttribute('opened', '');
    //       }
    //       if (iconbutton) {
    //         if (iconbutton.icon === 'arrow-drop-down')
    //           iconbutton.set('icon','arrow-drop-up');
    //         else
    //           iconbutton.set('icon','arrow-drop-down');
    //       }
    //     }
    //   },
    //   // Panel Control
    //   openAlarmPanel: function() {
    //     this.$.alarmPanel.classList.add("alarm-panel-opened");
    //   },
    //   closeAlarmPanel: function() {
    //     this.$.alarmPanel.classList.remove("alarm-panel-opened");
    //   },
    //   toggleAlarmPanel: function() {
    //     this.$.alarmPanel.classList.toggle("alarm-panel-opened");
    //   },
    //   toggleDrawer: function(){
    //     this.$.drawerPanel.classList.toggle("drawer-opened");
    //     this.$.backdrop.classList.toggle("backdrop-opened");
    //   },
    //   closeDrawer: function(){
    //     this.$.drawerPanel.classList.remove("drawer-opened");
    //     this.$.backdrop.classList.remove("backdrop-opened");
    //   },
    //   toggleTabs: function(){
    //     this.$.systemsTabs.classList.toggle("tabs-opened");
		// 		this.fire('resize');
    //   },
    //   closeTabs: function(){
    //     this.$.systemsTabs.classList.remove("tabs-opened");
		// 		this.fire('resize');
    //   },
    //   activeChanged: function() {
    //     var preconf = JSON.parse(localStorage.getItem(window.Name));
    //     if (this.active === true && preconf && preconf.selectedSystems) {
    //       this.$.panelSelector.select(preconf.selectedSystems[0]);
    //     }
    //     this.notifyResize();
    //   }
    // });
  </script>
</dom-module>
