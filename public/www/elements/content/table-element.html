<link rel='import' href='../behaviors/element-behavior.html'>
<dom-module id='table-element'>
	<template strip-whitespace>
  <style>
    :host {
      /*height needs to be set by outer element*/
      color: var(--primary-text-color);
      display: flex;
      height: 100%;
			min-width: 10em;
      text-align: left;
      font-size: 0.75em;
      line-height: 1.5em;
			flex-shrink: 2 !important;
      cursor: default;
      z-index: auto;
      background: white;
      border-radius: inherit;
    }
    :host([dark]) {
      background: #a8a8a8;
    }
		span {
			font-size: 1em;
			position: relative;
			padding: 0em 0.75em;
		}
    #table {
      display: inline-flex;
			width: 100%;
			height: 100%;
			flex-direction: column;
      position: relative;
      border-color: inherit;
    }
    #caption {
      display: block;
      position: relative;
      font-size: 0.9em;
      font-weight: bold;
      padding: 0em 1.5em;
    }
		.tr {
			display: flex;
			justify-content: space-between;
		}
		.tr:not([state]), .tr[state="0"] {
			background: none; color: inherit;
		}
		.tr:nth-of-type(even) {
			background: rgba(137, 137, 137, 0.15);
		}
		.tr[state="1"] {
			background: var(--element-state-exceeds-color);
			color: var(--element-state-exceeds-text-color);
		}
		.tr[state="-1"] {
			background: var(--element-state-deceeds-color);
			color: var(--element-state-deceeds-text-color);
		}
		.tr[state="undefined"] {
			background: var(--element-state-undefined-color);
			color: var(--element-state-undefined-text-color);
		}
		.tr[onlyfirstrow] > span:not(:first-of-type) {
			display: none;
		}
		#head {
			display: flex;
			justify-content: space-around;
			width: 100%;
			line-height: 2em;
			border-bottom-style: solid;
			border-bottom-width: thin;
			border-color: inherit;
			cursor: pointer;
			text-align: center;
		}
		[hidden] {
			display: none !important;
		}
		#list {
			height: auto;
			width: 100%;
			flex: 1 1 50px;
		}
  </style>

    <section id='table'>
      <section id='caption'>[[caption]]</section>
      <section id='head' hidden$='[[hideHeader]]' on-tap='switchOrder'>
        <span>Datum</span>
        <span hidden$="[[onlyFirstRow]]">Wert <span hidden$="[[!unit]]" style="font-style:italic;">([[unit]])</span></span>
      </section>
			<iron-list id='list' items="[[values]]" as="value">
				<template>
	        <div class="tr" state$="[[value.state]]" onlyfirstrow$="[[onlyFirstRow]]">
		        <span>[[toDate(value.x)]]</span>
		        <span>[[getValue(value.y, value.state)]]</span>
	        </div>
	      </template>
			</iron-list>
    </section>
  </template>

	<script>
		TableElement = Polymer({
			is: 'table-element',

			behaviors: [
				ElementBehavior
			],

			properties: {
				caption: {
					type: String,
					value: ''
				},
				onlyFirstRow: {
					type: Boolean,
					value: false
				},
				hideHeader: {
					type: Boolean,
					value: false
				},
				showFullDate: {
					type: Boolean,
					value: false
				}
			},

			_list: Object,

			attached: function() {
				this._list = this.$.list;
			},

			insertValues: function(values) {
				if (!this._list || !this._list.items || !values || !values.length) return;

				// console.log(this.values.length - values.length, values.length);
				// this.notifySplices('values', [{
				// 	index: this.values.length + 1 - values.length,
				// 	addedCount: values.length,
				// 	object: this.values,
				// 	removed: [],
				// 	type: 'splice'
				// }]);

				values.forEach(function(value) {
					this.unshift('items', value)
				}, this._list)
			},

			spliceValues: function(splices) {
				splices.forEach(function(value) {
					this.pop('items')
				}, this._list)
			},

      getValue: function(y, state) {
        return this.isBoolean ? ( state ? '✗' : '✓' ) : y;
      },

      clearValues: function() {
        this._list.set('items', []);
      },
		});
	</script>

</dom-module>
